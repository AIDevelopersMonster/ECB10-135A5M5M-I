GPIO Test Tool

ECB10-135A5M5M-I (STM32MP135)

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ GPIO, –≤—ã–≤–µ–¥–µ–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–∞–∑—ä—ë–º—ã –ø–ª–∞—Ç—ã
ECB10-135A5M5M-I, —Å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–º–∏ CLI-–∫–æ–º–∞–Ω–¥–∞–º–∏.

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –∫–∞–∫:

–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç,

–ø—Ä–∏–º–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å GPIO –ø–æ–¥ Linux,

–∏ –Ω–∞–≥–ª—è–¥–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–æ—á–µ–º—É –Ω–µ–ª—å–∑—è blindly –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚Äú–≤—Å–µ GPIO SoC‚Äù.

1. –ö–∞–∫–∏–µ GPIO –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –ø–ª–∞—Ç–µ (–í–ê–ñ–ù–û)

–ù–∞ –ø–ª–∞—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –≤—ã–≤–µ–¥–µ–Ω—ã —Ç–æ–ª—å–∫–æ 4 GPIO, —á–µ—Ä–µ–∑ —Ä–∞–∑—ä—ë–º—ã UIO1 –∏ UIO2.

–≠—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:

Product Manual

–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ —Ä–∞–∑—ä—ë–º–æ–≤ (Definition of UIO1 / UIO2 pin)

—Å—Ö–µ–º–æ–π –ø–ª–∞—Ç—ã

‚úîÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ GPIO
GPIO	–†–∞–∑—ä—ë–º	Pin	Sysfs ‚Ññ
GPIO_PA1	UIO1	pin 10	1
GPIO_PA11	UIO1	pin 9	11
GPIO_PA8	UIO2	pin 5	8
GPIO_PE6	UIO2	pin 6	70

‚ö†Ô∏è –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ GPIO STM32MP135:

–ª–∏–±–æ –Ω–µ —Ä–∞–∑–≤–µ–¥–µ–Ω—ã,

–ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–ª–∞—Ç–æ–π (reset, power, ethernet, display –∏ —Ç.–¥.),

–ª–∏–±–æ –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ü–æ—ç—Ç–æ–º—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —ç—Ç–∏–º–∏ 4 GPIO.

2. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ GPIO Test Tool

–í–∫–ª–∞–¥–∫–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è:

–±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ GPIO,

—á—Ç–µ–Ω–∏—è –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è (0 / 1),

–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è,

–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è GPIO –±–µ–∑ reboot,

–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ debugfs.

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç –∫–∞–∫ –¥–ª—è:

—Ä—É—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫,

—Ç–∞–∫ –∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.

3. –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (GUI)
üîò Init pins

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GPIO:

–≤—ã–ø–æ–ª–Ω—è–µ—Ç export –¥–ª—è –≤—Å–µ—Ö 4 GPIO,

–Ω–µ –º–µ–Ω—è–µ—Ç direction/value,

–ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—ë—Ç sysfs-—É–∑–ª—ã.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ GPIO —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã –≤ /sys/class/gpio/.

üîò Cleanup pins

–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è ‚Äú–º—è–≥–∫–∞—è –æ—á–∏—Å—Ç–∫–∞‚Äù GPIO:

–î–ª—è –∫–∞–∂–¥–æ–≥–æ GPIO:

echo in > direction


–ó–∞—Ç–µ–º:

unexport


‚úîÔ∏è GPIO –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
‚úîÔ∏è consumer sysfs –∏—Å—á–µ–∑–∞–µ—Ç
‚úîÔ∏è reboot –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —Ç.–∫. –ø–∏–Ω—ã UNCLAIMED –≤ pinctrl

üîò Reboot

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞—Ç—ã –∏–∑ GUI.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π reset –≤—Å–µ–≥–æ pinctrl, –∫–∞–∫ –ø–æ—Å–ª–µ —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞.
–í –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ ‚Äî –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

üìä –¢–∞–±–ª–∏—Ü–∞ GPIO

–î–ª—è –∫–∞–∂–¥–æ–≥–æ GPIO –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

–∏–º—è (PA1 / PA8 / PA11 / PE6),

direction (in / out),

value (0 / 1),

—Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.

–ß—Ç–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —É—Å—Ç–æ–π—á–∏–≤–æ ‚Äî UI –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ 0 –∏–ª–∏ 1, –¥–∞–∂–µ –µ—Å–ª–∏ –≤ –≤—ã–≤–æ–¥–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –µ—Å—Ç—å ‚Äú–º—É—Å–æ—Ä‚Äù.

4. –ü–æ—á–µ–º—É –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ reboot

–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ debugfs –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

GPIO –Ω–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω—ã –∑–∞ pinctrl (UNCLAIMED)

–ø—Ä–∏ export –ø–æ—è–≤–ª—è–µ—Ç—Å—è consumer sysfs

–ø—Ä–∏ unexport consumer –∏—Å—á–µ–∑–∞–µ—Ç

–ü–æ—ç—Ç–æ–º—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

direction=in ‚Üí unexport


—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç GPIO –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–∞—Ç—ã.

5. –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ (CLI)
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫—Ç–æ –¥–µ—Ä–∂–∏—Ç GPIO
cat /sys/kernel/debug/gpio | grep -E "gpio-1 |gpio-8 |gpio-11|gpio-70"


–û–∂–∏–¥–∞–µ–º–æ–µ:

–ø–æ—Å–ª–µ Init ‚Üí |sysfs

–ø–æ—Å–ª–µ Cleanup ‚Üí consumer –ø—É—Å—Ç–æ–π

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å pinmux (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å UNCLAIMED)
grep -Ei "PA1|PA8|PA11|PE6" /sys/kernel/debug/pinctrl/*/pinmux-pins

–†—É—á–Ω–æ–π export GPIO
cd /sys/class/gpio
echo 1  > export
echo 8  > export
echo 11 > export
echo 70 > export

–†—É—á–Ω–æ–π unexport GPIO
cd /sys/class/gpio
echo 1  > unexport
echo 8  > unexport
echo 11 > unexport
echo 70 > unexport

–£—Å—Ç–æ–π—á–∏–≤–æ–µ —á—Ç–µ–Ω–∏–µ value (–±–µ–∑ —ç—Ö–∞ –∏ –º—É—Å–æ—Ä–∞)
cat /sys/class/gpio/gpio11/value 2>/dev/null | tr -dc '01' | tail -c 1 ; echo


–í—Å–µ–≥–¥–∞ –≤–µ—Ä–Ω—ë—Ç:

0
–∏–ª–∏
1

–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
echo out > /sys/class/gpio/gpio11/direction
echo in  > /sys/class/gpio/gpio11/direction

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è (–¥–ª—è output)
echo 1 > /sys/class/gpio/gpio11/value
echo 0 > /sys/class/gpio/gpio11/value

6. –ü–æ—á–µ–º—É –∑–¥–µ—Å—å –ù–ï–¢ auto-scan GPIO

Auto-scan GPIO –ø–æ SoC (debugfs, gpioinfo) –ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–≤–æ–¥–∫—É –ø–ª–∞—Ç—ã.

–≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:

—Ä–∞–±–æ—Ç–µ —Å –Ω–µ–≤—ã–≤–µ–¥–µ–Ω–Ω—ã–º–∏ –ø–∏–Ω–∞–º–∏,

–∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º —Å reset / power / ethernet,

–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—é –ø–ª–∞—Ç—ã.

üëâ –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∂—ë—Å—Ç–∫–∏–π whitelist GPIO, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π.

7. –ò—Ç–æ–≥–æ–≤–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

‚ùå –Ω–µ ‚Äú–≤—Å–µ GPIO STM32‚Äù

‚úÖ —Ç–æ–ª—å–∫–æ GPIO –ø–ª–∞—Ç—ã

‚ùå guessing

‚úÖ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ—Å—Ç—å

‚úÖ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –∂–µ–ª–µ–∑–∞

‚úÖ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ –æ–±—É—á–µ–Ω–∏—è