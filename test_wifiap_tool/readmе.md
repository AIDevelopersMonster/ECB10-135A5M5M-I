# WiโFi Access Point (AP) + Internet Sharing

ะญัะพั ัะฐะทะดะตะป ะพะฟะธััะฒะฐะตั **ัะฐะฑะพัะธะน ะธ ะฟัะพะฒะตัะตะฝะฝัะน ะฒะฐัะธะฐะฝั ะฟะพะดะฝััะธั WiโFi ัะพัะบะธ ะดะพัััะฟะฐ (AP)** ะฝะฐ ะฟะปะฐัะต **ECB10โ135A5M5MโI (STM32MP135)** ั ะฒะพะทะผะพะถะฝะพัััั:

- ัะฐะฑะพัั **ะฑะตะท ะธะฝัะตัะฝะตัะฐ** (ะปะพะบะฐะปัะฝะฐั ัะพัะบะฐ ะดะพัััะฟะฐ);
- ัะฐะฑะพัั **ั ะธะฝัะตัะฝะตัะพะผ** (NAT / Internet sharing);
- ะทะฐะฟััะบะฐ **ะฑะตะท connman** ะฝะฐะฟััะผัั ะธะท ะบะพะฝัะพะปะธ ะธะปะธ ัะตัะตะท GUIโะฟัะธะปะพะถะตะฝะธะต.

ะะตะทัะปััะฐั ะฟะพะดัะฒะตัะถะดัะฝ ัะตะฐะปัะฝัะผ ะฟะพะดะบะปััะตะฝะธะตะผ ัะตะปะตัะพะฝะฐ ะธ ะฟัะพะฒะตัะบะพะน ััะฐัะธะบะฐ.

---

## ะัะฐัะบะพ ะพ ะฟะพะดัะพะดะต

ะั **ะพัะพะทะฝะฐะฝะฝะพ ะฝะต ะธัะฟะพะปัะทัะตะผ connman**, ััะพะฑั:

- ะฟะพะปะฝะพัััั ะบะพะฝััะพะปะธัะพะฒะฐัั ัะตัะตะฒัั ะบะพะฝัะธะณััะฐัะธั;
- ะธะทะฑะตะถะฐัั ะบะพะฝัะปะธะบัะพะฒ ั `hostapd`, `dnsmasq`, `udhcpc`, `wpa_supplicant`;
- ะฟะพะปััะธัั ะฒะพัะฟัะพะธะทะฒะพะดะธะผัะน ะธ ะพัะปะฐะถะธะฒะฐะตะผัะน ััะตะฝะฐัะธะน.

ะัะฟะพะปัะทัะตััั ะบะปะฐััะธัะตัะบะฐั ัะฒัะทะบะฐ:

- `hostapd` โ ัะพัะบะฐ ะดะพัััะฟะฐ WiโFi
- `dnsmasq` โ DHCP + DNS
- `ip / iptables` โ ะฐะดัะตัะฐัะธั ะธ NAT

---

## ะััะธัะตะบัััะฐ ัะตัะธ

```
[ Internet ]
     |
  eth0 / usb0 / wlanX (uplink)
     |
  NAT (iptables)
     |
  wlan0  (AP)
  192.168.10.1/24
     |
  WiโFi clients (phone, laptop)
```

- **wlan0** โ ัะฐะฑะพัะฐะตั ะฒ ัะตะถะธะผะต AP
- **192.168.10.1** โ IP ะฟะปะฐัั
- DHCP ะดะธะฐะฟะฐะทะพะฝ: `192.168.10.50 โ 192.168.10.150`

---

## ะัะพะฒะตัะตะฝะฝัะน ะบะพะฝัะธะณ dnsmasq

```ini
interface=wlan0
bind-interfaces
except-interface=lo
listen-address=192.168.10.1

dhcp-range=192.168.10.50,192.168.10.150,255.255.255.0,12h

# default gateway
dhcp-option=3,192.168.10.1

# DNS servers
dhcp-option=6,1.1.1.1,8.8.8.8

no-resolv
port=0
```

โ๏ธ ะะฐะถะฝะพ:
- ะพัะธะฑะบะฐ `bad option` ะฑัะปะฐ ะฒัะทะฒะฐะฝะฐ ะพะฟะตัะฐัะบะพะน (`ption=6` ะฒะผะตััะพ `dhcp-option=6`)
- ะฟะพัะปะต ะธัะฟัะฐะฒะปะตะฝะธั ะธ **ะฟะตัะตะฟะพะดะบะปััะตะฝะธั ะบะปะธะตะฝัะฐ** DNS ะฝะฐัะฐะป ัะฐะฑะพัะฐัั ะบะพััะตะบัะฝะพ

---

## ะะธะฝะธะผะฐะปัะฝะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะทะฐะฟััะบะฐ (CLI)

```sh
# ะััะฐะฝะพะฒะธัั ะฒัั, ััะพ ะผะพะถะตั ะผะตัะฐัั
killall connmand wpa_supplicant udhcpc hostapd dnsmasq 2>/dev/null || true

rfkill unblock wifi

ip link set wlan0 up
ip addr flush dev wlan0
ip addr add 192.168.10.1/24 dev wlan0

# AP
hostapd -B /etc/hostapd.conf

# DHCP + DNS
dnsmasq -C /tmp/wifiap/dnsmasq.conf
```

ะัะพะฒะตัะบะธ:

```sh
ip addr show wlan0
iw dev wlan0 station dump
ss -lunp | grep :67
ss -ltnup | grep :53
```

---

## ะะฝัะตัะฝะตั ะดะปั ะบะปะธะตะฝัะพะฒ (NAT)

ะัะปะธ uplink โ ะฝะฐะฟัะธะผะตั `eth0`:

```sh
# ะะฐะทัะตัะฐะตะผ ัะพัะฒะฐัะดะธะฝะณ
echo 1 > /proc/sys/net/ipv4/ip_forward

# NAT
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT
```

๐ ะกะธะผะฟัะพะผั ะธ ะดะธะฐะณะฝะพััะธะบะฐ:

| ะกะธะผะฟัะพะผ | ะัะธัะธะฝะฐ |
|------|-------|
| Ping ะธะดัั, ัะฐะนัั ะฝะต ะพัะบััะฒะฐัััั | DNS ะฝะต ะฒัะดะฐะฝ ะบะปะธะตะฝัั |
| IP ะตััั, ะธะฝัะตัะฝะตัะฐ ะฝะตั | ะฝะตั NAT |
| ะะฐะฑะพัะฐะตั ะฟะพัะปะต ะฟะตัะตะฟะพะดะบะปััะตะฝะธั | ะบะปะธะตะฝั ะทะฐะบะตัะธัะพะฒะฐะป DNS |

---

## GUIโัะตะฐะปะธะทะฐัะธั

ะ ะฟัะพะตะบัะต ะดะพะฑะฐะฒะปะตะฝะฐ ะฒะบะปะฐะดะบะฐ **WiFi AP**:

- ะบะฝะพะฟะบะฐ **Start AP (Clean)** โ ัะธัััะน ะปะพะบะฐะปัะฝัะน AP ะฑะตะท ะธะฝัะตัะฝะตัะฐ
- ะบะฝะพะฟะบะฐ **Start AP + Internet** โ AP ั NAT
- ะฒัั ะปะพะณะธะบะฐ ะทะฐะฟััะบะฐะตััั **ัะตัะตะท shellโะบะพะผะฐะฝะดั**
- `connman` ะฝะต ะธัะฟะพะปัะทัะตััั

ะัะดะตะปัะฝะพ:
- ััััะฐะฝะตะฝะฐ ะพัะธะฑะบะฐ, ะธะทโะทะฐ ะบะพัะพัะพะน ะฒะบะปะฐะดะบะฐ ะทะฐะบััะฒะฐะปะฐัั (ะฝะตะพะฑัะฐะฑะพัะฐะฝะฝะพะต ะธัะบะปััะตะฝะธะต)
- ะดะพะฑะฐะฒะปะตะฝะฐ ะทะฐัะธัะฐ ะพั ะฟะฐะดะตะฝะธั GUI ะฟัะธ ะพัะธะฑะบะต ะบะพะผะฐะฝะดั

---

## ะะพัะตะผั ััะพ ัะพัะพัะฐั ัะฐะฑะพัะฐ

- ัะตะฐะปัะฝะฐั ะพัะปะฐะดะบะฐ, ะฐ ะฝะต ยซะฟะพ ะผะฐะฝัะฐะปัยป;
- ะฝะฐะนะดะตะฝ ะธ ะธัะฟัะฐะฒะปะตะฝ **ัะตะฐะปัะฝัะน DNSโะฑะฐะณ**;
- ัััะบะพะต ัะฐะทะดะตะปะตะฝะธะต ัะพะปะตะน (AP / DHCP / NAT);
- ะปะตะณะบะพ ะฟะตัะตะฝะพัะธััั:
  - ะฒ initโัะบัะธะฟั
  - ะฒ systemdโservice
  - ะฒ ะดััะณะพะน SBC / Linux

ะญัะพ **ะณะพัะพะฒัะน ะธะฝะถะตะฝะตัะฝัะน ัะฐะฑะปะพะฝ**, ะฐ ะฝะต ัะบัะฟะตัะธะผะตะฝั.

---

## ะงัะพ ะผะพะถะฝะพ ัะปัััะธัั ะดะฐะปััะต

- ะฐะฒัะพะดะตัะตะบั uplinkโะธะฝัะตััะตะนัะฐ
- captive portal
- ัะพััะฐะฝะตะฝะธะต iptables
- ะฟะตัะตะบะปััะตะฝะธะต AP / Client
- ัะฟัะฐะฒะปะตะฝะธะต ะธะท WebUI

---

**ะัะพะณ:**
> ะะฐ, ััะพ ัะพั ัะฐะผัะน ัะปััะฐะน, ะบะพะณะดะฐ ยซะฑัะปะพ ัะปะพะถะฝะพ, ัะพัะตะปะพัั ะฑัะพัะธัั โ ะฝะพ ัะดะตะปะฐะปะธ ะฟัะฐะฒะธะปัะฝะพยป. ๐

